> mysql必知必会读书笔记



目录完全按照mysql必知必会来



# 了解SQL



## 数据库基础



在深入了解MySQL之前有必要了解数据库的基础知识



### 什么是数据库

数据库是一种以某种方式有组织的方式存储的数据集合

理解数据库：将数据库想象成一个文件柜，此文件柜是一个存储文件的物理位置，不用管数据是如何存放的以及以什么方式存放的



:key:**数据库**（database）：保存有组织的数据的容器（通常是一个或者一组文件）

> :warning:：人们通常用数据库这个术语来表示他们使用的数据库软件，这是引起混淆的根源，数据库软件应该被称为DBMS（数据库管理系统），数据库是通过DBMS来操纵的容器，数据库是什么并不重要，因为你使用的是DBMS，他替你访问数据库。





### 表

表是一种结构化的文件，可以用来存储某种特定类型的数据



:key:**表**（table）：某种特定类型数据的结构化清单



存储于表中的数据应该是一种类型的数据或者是一个清单，绝不是根据业务逻辑将多个清单混合存入一个表中，这样会使得以后的检索和访问都很困难

数据库中的每个表都有一个唯一的名字

> :warning:：表名的唯一性取决于多个因素，例如数据库名，在不同的数据库中可以存在同名的表



表具有某些特性，描述表的这些信息就是所谓的模式，模式可以用来描述数据库中特定的表以及整个数据库和其中表的关系



:key:：**模式**（schema）：关于数据库和表的布局及特性的信息

> 有时候，模式用作数据库的近义词，模式的含义在上下文中不是很清晰





### 列和数据类型

表由列构成，列中存储表的各方面信息



:key:：**列**（column）：表中的一个字段，所有的表都是由一个列或多个列组成



正确得将数据分解成多个列及其重要，如果处理不好可能造成排序和过滤非常苦难



每个列都具有相应的数据类型



:key:**数据类型**（datatype）：所容许的数据类型，每个列都具有相应的数据类型，它限制（容许）该列中存储的数据



### 行



:key:**行**（row）：表中的一个记录

> 经常提到行（row）时将其称为数据库记录（record），很大程度上这两个术语是可以相互替代的，但从技术层面上来说行更规范





### 主键



表中的每一行都应该有可以唯一标识自己的一列（或一组列）



:key:**key**（primary key）：一列**（或一组列）**，其值能唯一区分表中的每一行

主键可以中来标识特定的一行，没有主键，更新和删除表中的某一特定行就很困难，因为有可能直接删除了多行

> 设计人员都应该保证他们创建的每个表都具有一个主键，以便于以后的数据操作和管理



只要满足一下条件，该列即可作为主键：

- 任意两行都不具有相同的主键值
- 每一行都必须要具有一个主键值（即主键值不能为NULL）

> 这里的规则是MYSQL本身强制施行的



主键通常作用在表的一个列上，但也可以使用多个列作为主键，使用多列作为主键时，上述条件作用于主键的所有列，但第二点有所改变，只需要列值的组合唯一即可（不需要保证单个列的值唯一）

>除以上MySQL强制要求的几点之外，应该还有以下好习惯：
>
>- 不更新主键列中的值
>- 不重用主键列的值
>- 不将可能更改的列定义为主键：例如如果使用供应商的名字作为主键，那么当供应商合并或者更改名字时，主键也要随之改变，不合理



还有一个重要的键：外键





## 什么是SQL

SQL是结构化查询语言（Structured Query Language）的缩写，SQL是一门专门永安里和数据库通信的语言，与其他的编程语言不同，SQL只有很少的关键字，这是为了提供一种从数据库中读写数据的简单有效的方法。

SQL优点：

- SQL不是某个特定数据库提供商专有的语言，几乎所有的DBMS都支持SQL
- SQL简单易学，都是用少量简单的英文单词描述
- SQL灵活性高，可以进行复杂和高级的数据库操作



> 事实上任意两个DBMS实现的SQL都不完全相同，虽然他们绝大多数语法相同，所以SQL语句不是可以完全移植的









# MySQL简介



## 什么是MySQL



数据的所有存储，检索，管理和处理实际上是由数据库软件——DBMS来完成的，MySQL即是一种DBMS，他是一种数据库管理软件



MySQL的优点：

- 成本低：开源的，一般可以免费使用和免费修改
- 性能：MySQL执行非常快
- 可信赖：很多公司和站点都使用的是MySQL
- 简单：易于安装和使用



唯一缺点：不总是支持其他DBMS提供的功能和特性，这一步也在随着版本提升而改善





### 客户机-服务器软件

DBMS分为两类：

- 基于文件共享系统的DBMS
- 基于客户机-服务器的DBMS

前者包括微软的Access和FileMaker，一般用于桌面用途，不具有高可靠性

后者包括MySQL，Oracle以及SQL Server，将其分为两个部分，服务器部分是负责数据访问和处理的一个软件，运行在被称为数据库服务器的计算机上

客户机通过向服务器发送网络请求给服务器，进行数据处理并且返回数据（如果有返回值的话）

大多数网络连接都不具备对数据的访问权，甚至不具备对存储数据的驱动器的访问权，只是通过MySQL进行了交互

- 服务器软件为MySQL DBMS
- 客户机可以是MySQL提供的工具，脚本语言（Perl），web应用开发语言（JSP，PHP），程序设计语言（C，C++，Java）等



### MySQL版本



主要是DBMS版本引入的更改：

- 4：InnoDB引擎，事务处理，并，改进全文本搜索
- 4.1：函数库，子查询，集成帮助
- 5：存储过程，触发器，游标，视图





## MySQL工具



客户端工具推荐



### mysql命令行实用程序



使用注意点：

- 命令输入在>mysql之后（你也无法输入在前面）
- 命令用；或者\g结尾，不是Enter
- 输入help获取帮助（help select 获取 SELECT语句的帮助）
- 使用quit或者exit来退出命令行实用程序



> ​	即使你选择了使用后面所述的某个图形工具，也必须保证熟悉mysql命令行实用程序



### MySQL Administrator



MySQL官方提供的图形交互客户机，需要单独安装





### MySQL Query Broswer



MySQL官方提供的图形交互客户机，用来编写和执行MySQL命令







# 使用MySQL



## 连接



如果你使用的是本地服务器，并且试用MySQL，使用root登陆就可以了，但是在实际开发中需要用户列表，权限关联等操作来提升数据库的安全性



可以使用流行的navicat客户端来进行用户图形化操作

连接到MySQL需要以下信息：

- 主机名：本地就是localhost
- 端口，一般是3306
- 合法用户名
- 用户口令（密码）【如果需要】



以下均使用命令行工具来操作



## 连接



最初连接到MySQL，没有任何数据库打开让你使用，需要使用USE关键字来选择数据库

```mysql
USE （数据库表名）;
```

:key: 关键字（key word）：MySQL语言的保留字，不要使用mysql关键字去命名表和列





### 了解数据库和表



展示数据库和表

```mysql
SHOW DATABASES;
SHOW TABLES;
```



SHOW同样也可以用来展示列：

```mysql
SHOW COLUMNS FROM USER;
```

> SQL语句一般关键词用大写，自定义的表名或者数据库名用小写，尽管SQL是不区分大小写的，查询user表用以上语句不会报错

可以显示字段名，数据类型，是否允许为NULL，键信息，是否为auto_increment等



> 自动增量：
>
> ​	某些表需要使用唯一值来作为主键，可以代替手动分配唯一值，可以在create表格的时候b把它当作表定义的组成部分



> 上述语句可以使用DESCRIBE语句来代替，即DESCRIBE user是SHOW COLUMNS FROM user的简写



所支持的其他SHOW语句还有

- SHOW STATUS：显示服务器状态
- SHOW GRANTS：显示用户和其具有的权限
- SHOW ERRORS 和 SHOW WARNINGS：显示服务器错误或警告消息

更多SHOW语句用法可以执行HELP SHOW语句来查看



# 检索数据

如何使用SELECT 语句检索出一个或多个数据列



## SELECT语句



SELECT是非常常用的关键字

使用SELECT关键字必须给出两条信息：想选择什么，以及从什么地方选择





## 检索单个列



![image-20200322210728532](images/image-20200322210728532.png)

假设表的结构如图所示



检索username这一列

```mysql
 SELECT username FROM user;
```

即可，标准格式`SELECT (COLUMNS) FROM (TABLE)`

> 数据没有排序，输出的结果可能是数据被添加到表里面的顺序，也可能不是，只要返回相同的数目即是正常的

因为SQL语句（至少mysql）是遇到分号才算一条语句的结束，所以可以将一条语句拆分成多行（也是非常推荐的），这样便于阅读。



## 检索多个列



数据表还是如上图，假设要检索username和password这两个列

```mysql
SELECT username,password FROM user
```



SQL语句一般返回原始的，无格式的数据，至于数据的格式化问题，转换问题则是要在业务层中解决





## 检索所有列



使用通配符的方式来解决 *代表任意

```mysql
SELECT * FROM user
```

> :warning:：除非你要检索数据的每个列，最好别用*通配符，虽然省事儿，但是检索不需要的列通常会降低程序的性能



## 检索不同的行



如果检索单列，只需要MySQL返回不同的值

使用DISTINCT（不同的）关键字即可，如检索username，只要不重复的，用法如下

```mysql
SELECT DISTINCT username FROM user;
```

会返回不同结果的username



DISTINCT关键字直接作用于所有列，而不是他后面的那个列，如

```mysql
SELECT DISTINCT username,password FROM user;
```

唯有username和password都相同的列才会被省去



## 限制结果

限制SELECT的输出结果（只取前几行），使用LIMIT关键字

```MYSQL
SELECT * FROM user LIMIT 5;
```

至多返回5行数据，如果不足5行则直接返回



为了方便演示，使用Java插入了一些数据，便于查询

数据截图：

![image-20200322215536498](images/image-20200322215536498.png)

1~3的id已经被使用了，即使被数据被删除了也不能再次使用【主键的规则】

使用上述limit语句查询显示4~8的id数据



> :warning:： mysql的行索引是从零开始的

所以`SELECT * FROM user LIMIT 5`查询的是行索引为0~4的数据

使用`SELECT * FROM user LIMIT a,b`查询的是行下标从5开始后的五个数据





## 使用完全限定的表名



迄今为止使用的SQL例子都只是列名引用列，也可以使用完全限定的名字来限定列：

```mysql
SELECT user.id FROM user LIMIT 5;
```

也可以限定表名字

```mysql
SELECT user.id FROM test.user LIMIT 5;
```

通过 `表名.列名` 或者 `数据库名.表名` 来完全限定







# 排序检索数据

 

使用SELECT 的 ORDER BY 子句，根据需要排序检索出的数据



## 排序数据

使用 `SELECT * FROM user` 检索出的数据并不是纯粹的随机排列，如果不排序，数据一般都是按照它在底层表中出现的顺序显示，也就是数据插入的数据，但是如果后来对数据进行了更新或者删除的话，则此顺序会受到MySQL回收存储空间的影响，因此，如果不明确控制，不能依赖默认的排列顺序



:key:**子句**（clause）：SQL语句由子句构成，一个子句通常包括一个关键字和所提供的数据组成，有些子句是必须的，有些子句是可选的

像 `SELECT * FROM user LIMIT 5` 的SELECT语句的FROM子句就是必须的，而LIMIT子句就是可选的，此ORDER BY 子句就是可选的：

```mysql
SELECT * FROM user ORDER BY username LIMIT 10;
```

> 默认是升序排列，一般ORDER BY的字段都是检索的字段，但是ORDER BY没有检索的字段也是完全合法的





## 按多个列排序



经常会出现这种情况，如果显示雇员清单，由姓和名两列（首先按照性排列，在每个性中再按照名排列），实现此功能只需要指定列名，列名之间用逗号隔开即可



```mysql
SELECT first_name,last_name FROM user ORDER BY first_name,last_name;
```

会先按照firstname排序，再通过lastname排序firstname相同的数据

如果firstname都是唯一的，则不用对lastname进行排序







## 指定排序方向



默认是升序排序，如果要使用降序排序，则使用DESC关键字即可

按照降序排列username：

```java
SELECT * FROM user ORDER BY username DESC LIMIT 10;
```



DESC和DISTINCT关键字不同，DISTINCT关键字会作用于所有的列，让其都保持唯一，而DESC则只会保持其前面的列是降序的，其余列都是保持默认的升序



> 如果想让多个列都进行降序排列，则必须在每个列上都指定DESC关键字

默认的升序排列关键字是ASC，但是ASC用的非常的少，因为默认就是ASC的





> 区分大小写的排序设置：因为MySQL是不区分大小写的，所以A和a的排列地位是一样的，如果要进行区分，需要数据库管理员对数据库进行配置，用简单的ORDER BY是做不到的



使用ORDER BY找出id最大的值

```mysql
SELECT id FROM user ORDER BY id LIMIT 1;
```

先按照id降序排列，再取最上面一个即获取到id的最大值



> 子句会有位置的问题，例如：只有按照	FROM子句 + ORDER BY 子句 + LIMIT 子句才不会报错，否则会报错







# 过滤数据



使用SELECT语句的WHERE子句来指定搜索条件



## 使用WHERE子句



很少需要检索表中的所有行，往往只需要指定指定搜索条件，也叫过滤条件

```mysql
SELECT * FROM user WHERE id = 0;
```

WHERE子句不止仅能进行相等判断



> SQL过滤和应用过滤：
>
> 数据也可以再客户端这边过滤，即服务器端仅仅返回所有数据，然后再客户端这边去处理，这种实现很不令人满意，不仅会让客户机的效率大大降低，还会导致网络的数据传输量加大，造成带宽的浪费





>  子句的排列顺序为：FROM    WHERE   ORDER BY    LIMIT





## WHERE子句操作符



| 操作符  |        说明        |
| :-----: | :----------------: |
|    =    |        等于        |
|   <>    |       不等于       |
|   !=    |       不等于       |
|    <    |        小于        |
|   <=    |      小于等于      |
|    >    |        大于        |
|   >=    |      大于等于      |
| BETWEEN | 再指定的两个词中间 |



### 检查单个值



```mysql
SELECT * FROM user WHERE username = 'ECAC3';
```

>  使用单引号和双引号的效果相同



```mysql
SELECT * FROM user WHERE id < 10;
```



### 不匹配检查



```mysql
SELECT * FROM user WHERE id <> 10;
```

等价于

```mysql
SELECT * FROM user WHERE id != 10;
```





### 范围值检查



可以使用BETWEEN关键字，不过于其他WHERE子句的操作符稍有不同

```mysql
SELECT * FROM user WHERE id BETWEEN 5 AND 10;
```

> BETWEEN  a  AND  b
>
> 一定是查询大于等于a小于等于b的值



以上语句等价于：

```mysql
SELECT * FROM user WHERE id >= 5 AND id <= 10;
```







### 空值检查



设计表时候即可指定这个字段能否为NULL



:key: ：NULL	无值（no value），与包含字段0，空字符串不同



SELECT由一种特殊的WHERE子句来检查具有空值的NULL

```mysql
SELECT * FROM user WHERE password IS NULL;
```



> :warning:：在匹配过滤和不匹配过滤中都不会返回当前列为NULL的行

