# MySQL实战四十五讲









## MySQl基础架构



![image-20201125180718190](images/image-20201125180718190.png)



大致可以分为server层和存储引擎层



Server层包括：连接器、查询缓存、分析器、优化器、执行器等，以及所有的内置函数，跨存储引擎的功能都是在这里实现，如存储过程，触发器，视图等

存储引擎负责数据的存储与提取，架构是插件式的



不同的存储引擎共用一个Server层



一条SQL语句执行的全过程：

- 连接器：负责和客户端建立连接、获取权限、维持和管理连接

```
mysql -h$ip -P$port -u$user -p
```

一旦连接成功，连接器就会去权限表里查看拥有的权限，之后都是直接依赖于这里获取到的权限来进行判断

连接时间是由参数wait_timeout控制的



- 查询缓存

在查询之前会先到查询缓存中判断是否有这条数据，查询缓存就是一组KV对，K是查询的语句，VALUE是结果，如果不在则继续进行查询操作，然后将结果缓存到查询缓存中



**但是大多数情况下我会建议你不要使用查询缓存，为什么呢？因为查询缓存往往弊大于利。**



主要是缓存失效频繁导致的，每一次对数据表的更新都会导致缓存的失效



MySQL8.0直接删除了查询缓存功能





- 分析器

先做词法分析，然后再做语法分析





- 优化器

优化器是在表里面有多个索引，决定使用哪个索引，或者是多表关联的时候决定表的连接顺序

优化器对语句执行方案的选择





- 执行器

开始执行语句，进行权限判断，调用引擎接口。





